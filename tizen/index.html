<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BitmovinYospacePlayer Demo</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" />

    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="css/bitmovin-demo.css" />

    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-core.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-polyfill.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-style.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-xml.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-advertising-core.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-advertising-bitmovin.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-mserenderer.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-engine-bitmovin.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-container-mp4.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-hls.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-dash.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-abr.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-container-ts.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-engine-native.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-tizen.js"></script>

    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer-ui.js"></script>
    <link rel="stylesheet" href="https://cdn.bitmovin.com/player/web/8/bitmovinplayer-ui.css" />

    <script type="text/javascript" src="js/bitmovin-player-yospace.js"></script>

    <script type="text/javascript" src="js/sources.js"></script>
  </head>
  <body>
    <div id="wrapper">
      <div id="banner">
        <div class="logo">
          <a href="https://bitmovin.com"><img src="images/bitmovin-logo.png" /></a>
        </div>
        <div class="title"><h1 class="bitmovin-headline">BitmovinYospacePlayer Demo</h1></div>
        <div class="clearfix"></div>
      </div>

      <div class="container-fluid">
        <div class="content">
          <div class="row bitmovin-description">
            <div class="col-lg-12 text-center" id="source-names"></div>
          </div>
          <div class="row">
            <div class="col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
              <div id="player"></div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12 text-center">
              <p>
                For more information about the bitmovin player, please have a look at our online
                <a href="https://developer.bitmovin.com" target="_blank">Developer Section</a>.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      var yospacePlayer;

      setupControllerEvents();

      var truexAdFree = false; // disable Truex

      var conf = {
        key: 'YOUR-KEY',
        playback: {
          muted: false,
          autoplay: true,
        },
        logs: {
          level: 'none',
        },
        ui: false,
        tweaks: {
          file_protocol: true, // Required if app is being loaded from file system
          app_id: 'Ff4zhu5kqV.TizenBitmovinYospacePlayer', // this Tizen App Id should also be allow-listed in Player License and optionallt, Analaytics License
        },
      };

      // Yospace configuration
      var yospaceConfig = {
        debug: false,
        disableVpaidRenderer: false,
        liveVpaidDurationAdjustment: 2,
        disableStrictBreaks: false,
        disableServiceWorker: true, // Disable Service Worker for Tizen Web App use
        useTizen: true,
      };

      var sampleYospacePlayerPolicy = {
        canMute: function () {
          return true;
        },
        canSeek: function () {
          return true;
        },
        canSeekTo: function (seekTarget) {
          return seekTarget;
        },
        canSkip: function () {
          return true;
        },
        canPause: function () {
          return true;
        },
        canChangePlaybackSpeed: function () {
          return true;
        },
      };

      bitmovin.player.core.Player.addModule(window.bitmovin.player['polyfill'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['style'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['xml'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['advertising-core'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['advertising-bitmovin'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['engine-bitmovin'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['mserenderer'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['hls'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['dash'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['abr'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['container-ts'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['container-mp4'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['engine-native'].default);

      if (!yospaceConfig.disableServiceWorker) {
        bitmovin.player.core.Player.addModule(window.bitmovin.player['serviceworker-client'].default);
      }

      if (yospaceConfig.useTizen) {
        bitmovin.player.core.Player.addModule(window.bitmovin.player['tizen'].default);
      }

      var playerContainer = document.getElementById('player');
      yospacePlayer = new bitmovin.player.ads.yospace.BitmovinYospacePlayer(
        bitmovin.player.core.Player,
        playerContainer,
        conf,
        yospaceConfig
      );

      bitmovin.playerui.UIFactory.buildDefaultTvUI(yospacePlayer);

      addEventListeners();

      yospacePlayer.setPolicy(sampleYospacePlayerPolicy);
      yospacePlayer.load(sources.vodSource);

      function addEventListeners() {
        var infoEventList = [
          'playbackfinished',
          'ready',
          'play',
          'playing',
          'adbreakstarted',
          'adbreakfinished',
          'adstarted',
          'adfinished',
          'adquartile',
          'admanifestloaded',
          'subtitleadded',
        ];
        addEventLogger('info', infoEventList);

        var errorEventList = ['error'];
        addEventLogger('error', errorEventList);

        var warningEventList = ['warning'];
        addEventLogger('warning', warningEventList);

        var traceEventList = ['timechanged'];
        // addEventLogger('trace', traceEventList);

        var debugEventList = ['metadataparsed', 'metadata'];
        addEventLogger('debug', debugEventList);

        yospacePlayer.on('subtitleadded', function (event) {
          if (yospacePlayer.subtitles.list().length > 0) {
            yospacePlayer.subtitles.enable(yospacePlayer.subtitles.list()[0].id);
          }
        });

        yospacePlayer.on('playing', function (event) {
          if (yospacePlayer.subtitles.list().length > 0) {
            yospacePlayer.subtitles.enable(yospacePlayer.subtitles.list()[0].id);
          }
        });
      }

      function addEventLogger(type, eventList) {
        eventList.forEach(function (eventName) {
          yospacePlayer.on(eventName, function (event) {
            var timestamp = new Date(event.timestamp).toISOString();
            var playheadTime = event.time ? '@' + event.time : '@?';
            var msg = '[' + timestamp + '][YoSpacePlayer][' + event.type + playheadTime + ']: ' + JSON.stringify(event);
            console[type](msg);
          });
        });
      }

      function setupControllerEvents() {
        if (!window.tizen) {
          console.warn('This demo page is intended for Tizen TVs, but this does not look like Tizen.');
          return;
        }

        tizen.tvinputdevice.registerKey('MediaPlayPause');
        tizen.tvinputdevice.registerKey('ColorF0Red');

        // add eventListener for keydown
        document.addEventListener('keydown', function (e) {
          switch (e.keyCode) {
            case tizen.tvinputdevice.getKey('MediaPlayPause').code:
              if (player.isPlaying()) {
                player.pause();
              } else {
                player.play();
              }
              break;
            case 37: // LEFT arrow
              break;
            case 38: // UP arrow
              break;
            case 39: // RIGHT arrow
              break;
            case 40: // DOWN arrow
              break;
            case 13: // OK button
              break;
            case 10009: // RETURN button
              tizen.application.getCurrentApplication().exit();
              break;
            default:
              console.log('Key code : ' + e.keyCode);
              break;
          }
        });
      }
    </script>
  </body>
</html>
