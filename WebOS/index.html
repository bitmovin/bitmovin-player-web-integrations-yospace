<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BitmovinYospace Player WebOS</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" type="text/css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="src/css/style.css" />

    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-core.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-polyfill.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-style.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-xml.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-advertising-core.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-advertising-bitmovin.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-mserenderer.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-engine-bitmovin.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-container-mp4.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-hls.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-dash.js"></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-abr.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-container-ts.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-engine-native.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-drm.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-crypto.js"
    ></script>
    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/modules/bitmovinplayer-webos.js"></script>

    <script type="text/javascript" src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer-ui.js"></script>

    <link rel="stylesheet" href="https://cdn.bitmovin.com/player/web/8/bitmovinplayer-ui.css" />

    <script type="text/javascript" src="src/webOSTVjs-1.1.0/webOSTV.js"></script>
    <script type="text/javascript" src="src/webOSTVjs-1.1.0/webOSTV-dev.js"></script>
    <script type="text/javascript" src="src/js/bitmovin-player-yospace.js"></script>
    <script type="text/javascript" src="src/js/sources.js"></script>
    <!--<script type="text/javascript" src="src/js/main.js"></script>-->
  </head>
  <body>
    <div id="wrapper">
      <div id="banner">
        <div class="logo">
          <a href="https://bitmovin.com"><img src="src/images/bitmovin-logo.png" /></a>
        </div>
        <div class="title"><h1 class="bitmovin-headline">BitmovinYospace Player WebOS</h1></div>
        <div class="clearfix"></div>
      </div>

      <div class="container-fluid">
        <div class="content">
          <div class="row bitmovin-description"></div>
          <div id="webserver-warning">
            <h2>Unsupported Protocol</h2>
            <p>
              This file has been loaded using the unsupported "file" protocol. Please use a
              <a
                href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_web_server"
                target="_blank"
                >web server</a
              >
              and open this page using http or https.
            </p>
          </div>
          <div class="row">
            <div class="col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
              <div id="player"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      var yospacePlayer;

      setupControllerEvents();

      var truexAdFree = false; // disable Truex

      var conf = {
        key: 'YOUR-KEY',
        playback: {
          muted: false,
          autoplay: true,
          preferredTech: [
            {
              player: 'html5',
              streaming: 'dash',
            },
          ],
        },
        logs: {
          level: 'info',
        },
        ui: false,
        tweaks: {
          file_protocol: true,
          app_id: 'com.bitmovin.bitmovinyospaceplayer.demo',
        },
      };

      // Yospace configuration
      var yospaceConfig = {
        debug: false,
        disableVpaidRenderer: false,
        liveVpaidDurationAdjustment: 2,
        disableStrictBreaks: false,
        disableServiceWorker: true, //Disable Service Worker for WebOS Web App use
        useWebos: true,
      };

      var sampleYospacePlayerPolicy = {
        canMute: function () {
          return true;
        },
        canSeek: function () {
          return true;
        },
        canSeekTo: function (seekTarget) {
          return seekTarget;
        },
        canSkip: function () {
          return true;
        },
        canPause: function () {
          return true;
        },
        canChangePlaybackSpeed: function () {
          return true;
        },
      };

      bitmovin.player.core.Player.addModule(window.bitmovin.player['polyfill'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['style'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['xml'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['advertising-core'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['advertising-bitmovin'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['engine-bitmovin'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['mserenderer'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['hls'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['dash'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['abr'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['container-ts'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['container-mp4'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['engine-native'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['drm'].default);
      bitmovin.player.core.Player.addModule(window.bitmovin.player['crypto'].default);

      if (!yospaceConfig.disableServiceWorker) {
        bitmovin.player.core.Player.addModule(window.bitmovin.player['serviceworker-client'].default);
      }

      if (yospaceConfig.useWebos) {
        bitmovin.player.core.Player.addModule(window.bitmovin.player['webos'].default);
      }

      var playerContainer = document.getElementById('player');
      yospacePlayer = new bitmovin.player.ads.yospace.BitmovinYospacePlayer(
        bitmovin.player.core.Player,
        playerContainer,
        conf,
        yospaceConfig
      );

      bitmovin.playerui.UIFactory.buildDefaultTvUI(yospacePlayer);

      var keySystem = webOSDev && webOSDev.DRM.Type.WIDEVINE;
      var webosDrmAgent = getDrmAgent(keySystem);
      // In the app is started shortly after webOS is rebooted the DRM system and CMD
      // might not be fully ready to use for DRM playback. Therefore we should await
      // drmAgents onsuccess callback before we try to load DRM source.
      if (webosDrmAgent) {
        isDrmLoaded(webosDrmAgent)
          .then(function () {
            yospacePlayer.setPolicy(sampleYospacePlayerPolicy);
            yospacePlayer.load(sources.vodSource);
          })
          .catch(function (e) {
            console.log('Error while loading drm Agent', e);
          });
      }

      function setupControllerEvents() {
        document.addEventListener('keydown', function (inEvent) {
          var keycode;

          if (window.event) {
            keycode = inEvent.keyCode;
          } else if (inEvent.which) {
            keycode = inEvent.which;
          }
          switch (keycode) {
            case 13:
              if (player.isPaused()) {
                player.play();
              } else {
                player.pause();
              }
              break;
            case 415:
              // Play Button Pressed
              player.play();
              break;
            case 19:
              // Pause BUtton Pressed
              player.pause();
              break;
            case 412:
              // Jump Back 30 Seconds
              player.seek(player.getCurrentTime() - 30);
              break;
            case 417:
              // Jump Forward 30 Seconds
              player.seek(player.getCurrentTime() + 30);
              break;
            case 413:
              // Unload Player
              player.unload();
              break;
            default:
              console.log('Key Pressed: ' + keycode);
          }
        });
      }

      function getDrmAgent(keySystem) {
        return webOSDev && keySystem && webOSDev.drmAgent(keySystem);
      }

      function loadDrm(drmAgent) {
        return new Promise(function (resolve, reject) {
          try {
            drmAgent.load({
              onSuccess: function (res) {
                resolve(res);
              },
              onFailure: function (e) {
                reject(e);
              },
            });
          } catch (e) {
            reject('Error while loading DRM manager', e);
          }
        });
      }

      function isDrmLoaded(drmAgent) {
        return new Promise(function (resolve, reject) {
          if (!drmAgent) {
            return reject('No drmAgent');
          }

          drmAgent.isLoaded({
            onSuccess: function (response) {
              if (response.loadStatus === true) {
                resolve(response);
              } else {
                loadDrm(drmAgent)
                  .then(function (result) {
                    resolve(result);
                  })
                  .catch(function (err) {
                    reject(err);
                  });
              }
            },
            onFailure: function (err) {
              reject(err);
            },
          });
        });
      }

      function addEventListeners() {
        var infoEventList = [
          'playbackfinished',
          'ready',
          'play',
          'playing',
          'adbreakstarted',
          'adbreakfinished',
          'adstarted',
          'adfinished',
          'adquartile',
          'admanifestloaded',
          'subtitleadded',
        ];
        addEventLogger('info', infoEventList);

        var errorEventList = ['error'];
        addEventLogger('error', errorEventList);

        var warningEventList = ['warning'];
        addEventLogger('warning', warningEventList);

        var traceEventList = ['timechanged'];
        // addEventLogger('trace', traceEventList);

        var debugEventList = ['metadataparsed', 'metadata'];
        addEventLogger('debug', debugEventList);

        yospacePlayer.on('subtitleadded', function (event) {
          if (yospacePlayer.subtitles.list().length > 0) {
            yospacePlayer.subtitles.enable(yospacePlayer.subtitles.list()[0].id);
          }
        });

        yospacePlayer.on('playing', function (event) {
          if (yospacePlayer.subtitles.list().length > 0) {
            yospacePlayer.subtitles.enable(yospacePlayer.subtitles.list()[0].id);
          }
        });
      }

      function addEventLogger(type, eventList) {
        eventList.forEach(function (eventName) {
          yospacePlayer.on(eventName, function (event) {
            var timestamp = new Date(event.timestamp).toISOString();
            var playheadTime = event.time ? '@' + event.time : '@?';
            var msg = '[' + timestamp + '][YoSpacePlayer][' + event.type + playheadTime + ']: ' + JSON.stringify(event);
            console[type](msg);
          });
        });
      }
    </script>
  </body>
</html>
